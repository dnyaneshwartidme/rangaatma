{% extends 'ms_admin/base.html' %} {% block title %}Change Password{% endblock
%} {% block content %}

<!-- Bootstrap Icons CDN -->
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
  rel="stylesheet"
/>

<style>
  .password-wrapper {
    position: relative;
  }
  .password-wrapper input {
    padding-right: 2.5rem;
  }
  .toggle-password {
    position: absolute;
    top: 75%;
    right: 0.75rem;
    transform: translateY(-50%);
    cursor: pointer;
  }

  .form-container {
    background: #ffffff;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
  }

  .form-control:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
  }

  .btn-primary i {
    margin-right: 6px;
  }
</style>

<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-6 col-md-8 col-sm-12">
      <div class="form-container">
        <h3 class="text-primary mb-4 text-center">
          <i class="bi bi-key"></i> Change Password
        </h3>

        {% with messages = get_flashed_messages(with_categories=true) %} {% if
        messages %} {% for category, message in messages %}
        <div
          class="alert alert-{{ category }} alert-dismissible fade show"
          role="alert"
        >
          {{ message }}
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Close"
          ></button>
        </div>
        {% endfor %} {% endif %} {% endwith %}

        <form
          method="POST"
          action="{{ url_for('password') }}"
          id="passwordForm"
          novalidate
        >
          <!-- Old Password -->
          <div class="mb-3 password-wrapper">
            <label for="oldPassword" class="form-label">Old Password</label>
            <input
              type="password"
              class="form-control"
              name="old_password"
              id="oldPassword"
              placeholder="Enter your old password"
              required
            />
            <i class="bi bi-eye toggle-password" toggle="#oldPassword"></i>
            <div class="invalid-feedback">Please enter your old password.</div>
          </div>

          <!-- New Password -->
          <div class="mb-3 password-wrapper">
            <label for="newPassword" class="form-label">New Password</label>
            <input
              type="password"
              class="form-control"
              name="new_password"
              id="newPassword"
              placeholder="Enter new password"
              required
            />
            <i class="bi bi-eye toggle-password" toggle="#newPassword"></i>
            <div class="invalid-feedback">Please enter your new password.</div>
          </div>

          <!-- Confirm Password -->
          <div class="mb-4 password-wrapper">
            <label for="confirmPassword" class="form-label"
              >Confirm Password</label
            >
            <input
              type="password"
              class="form-control"
              name="confirm_password"
              id="confirmPassword"
              placeholder="Confirm new password"
              required
            />
            <i class="bi bi-eye toggle-password" toggle="#confirmPassword"></i>
            <div class="invalid-feedback" id="confirmError">
              Please confirm your password.
            </div>
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-primary">
              <i class="bi bi-lock-fill"></i> Update Password
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Toggle Password Script -->
<script>
  document.querySelectorAll(".toggle-password").forEach(function (icon) {
    icon.addEventListener("click", function () {
      const input = document.querySelector(this.getAttribute("toggle"));
      const type =
        input.getAttribute("type") === "password" ? "text" : "password";
      input.setAttribute("type", type);

      // Toggle icon class
      if (type === "text") {
        this.classList.remove("bi-eye");
        this.classList.add("bi-eye-slash");
      } else {
        this.classList.remove("bi-eye-slash");
        this.classList.add("bi-eye");
      }
    });
  });
</script>

<script>
  document
    .getElementById("passwordForm")
    .addEventListener("submit", function (e) {
      const oldPassword = document.getElementById("oldPassword");
      const newPassword = document.getElementById("newPassword");
      const confirmPassword = document.getElementById("confirmPassword");
      const confirmError = document.getElementById("confirmError");

      let isValid = true;

      // Validate Old Password
      if (!oldPassword.value.trim()) {
        oldPassword.classList.add("is-invalid");
        isValid = false;
      } else {
        oldPassword.classList.remove("is-invalid");
      }

      // Validate New Password
      if (!newPassword.value.trim()) {
        newPassword.classList.add("is-invalid");
        isValid = false;
      } else if (newPassword.value.trim() === oldPassword.value.trim()) {
        newPassword.classList.add("is-invalid");
        newPassword.nextElementSibling?.remove(); // remove old message if any

        const error = document.createElement("div");
        error.className = "invalid-feedback";
        error.innerText = "New password should not be same as old password.";
        newPassword.parentNode.appendChild(error);
        isValid = false;
      } else {
        newPassword.classList.remove("is-invalid");
      }

      // Validate Confirm Password
      if (!confirmPassword.value.trim()) {
        confirmPassword.classList.add("is-invalid");
        confirmError.innerText = "Please confirm your password.";
        isValid = false;
      } else if (newPassword.value !== confirmPassword.value) {
        confirmPassword.classList.add("is-invalid");
        confirmError.innerText =
          "New Password and Confirm Password do not match.";
        isValid = false;
      } else {
        confirmPassword.classList.remove("is-invalid");
      }

      if (!isValid) {
        e.preventDefault(); // prevent form from submitting
      }
    });
</script>

{% endblock %}
